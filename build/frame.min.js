!function(){"use strict";function e(){console.log.apply(this,arguments)}function t(e,t){for(let r of Object.getOwnPropertyNames(t))"name"!==r&&("object"==typeof t[r]?Array.isArray(t[r])?e[r]=[]:e[r]=Object.create(t[r]):Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r)));return e}function r(e,t,r){Object.defineProperty(e,"toString",{enumerable:!1,writable:!1,configurable:!0,value:function(){return t?"[Frame: "+t+"]":"[Frame: Constructor]"}}),Object.defineProperty(e,"name",{enumerable:!1,writable:!1,configurable:!!r,value:t})}e.error=function(){console.error.apply(this,arguments)},e.warn=function(){console.warn.apply(this,arguments)};const n={to:function(e){return o.call(this,"to",e,Array.from(arguments).slice(1)),this},from:function(e){return o.call(this,"from",e,Array.from(arguments).slice(1)),this},out:function(t,r){if(t)return e.error("Error:",t);e("out data:",r)},error:function(t){return e.error("Error:",t)}};function o(t,r,n){if(!this)throw new Error("Blueprint method called without class, did you assign it to a variable?");if(!this.Frame||!this.Frame.pipes)throw new Error("Not working with a valid Blueprint object");if("function"!=typeof r)throw new Error(this.Frame.name+".to() was called with improper parameters");e(t,"(): "+this.name),this.Frame.pipes.push({direction:t,target:r,params:n}),i(l,1,this)}function i(e,t,r){let n=e.name;clearTimeout(r.Frame.debounce[n]),r.Frame.debounce[n]=setTimeout(function(){delete r.Frame.debounce[n],e.call(r)},t)}function l(){if(!(this.Frame.processingFlow||this.Frame.pipes.length<1)){if(!this.Frame.initialized)return function(t){let r=this;try{const n=r.Frame.props?r.Frame.props:{};r.init.call(r,n,function(){e("Blueprint intialized"),r.Frame.props={},r.Frame.initialized=!0,t&&t.call(r)})}catch(e){throw new Error("Blueprint '"+r.name+"' could not initialize.\n"+e)}}.call(this,l);this.Frame.processingFlow=!0,e("Processing flow for "+this.name)}}const a={loaded:!1,initialized:!1,processingFlow:!1,props:{},flow:[],pipes:[],debounce:{},name:""};function c(e){if("function"==typeof e)return{type:e.name,expects:e};"object"!=typeof e&&(e={});let t=Object.create(e);Object.assign(t,e);for(let e of Object.keys(t))if("function"==typeof t[e])t[e]={required:!0,type:typeof t[e]()};else if("object"==typeof t[e]&&Array.isArray(t[e])){let r=t[e];t[e]={required:!1,type:"optional",types:[]};for(let n of r)"function"==typeof n&&t[e].types.push(typeof n())}else"object"==typeof t[e]&&t[e].type?t[e]={required:!0,type:t[e].type,expects:t[e].expects}:t[e]={required:!0,type:typeof t[e]};function r(e,r){return!t[e]||(!(!t[e].required||typeof r!==t[e].type)||(t[e].required||"optional"!==t[e].type?!(!t[e].required||!t[e].type||"function"!=typeof t[e].expects)&&t[e].expects(r):!(r&&!t[e].types.includes(typeof r))))}return function(e){let n={},o=e;for(let i of Object.getOwnPropertyNames(e)){const l=Object.getOwnPropertyDescriptor(e,i);l.writable&&l.configurable?t[i]?(n[i]=e[i],Object.defineProperty(o,i,{enumerable:l.enumerable,configurable:l.configurable,get:function(){return n[i]},set:function(e){if(!r(i,e))throw t[i].expects?(e="string"==typeof e?e:typeof e,new Error('Expecting "'+i+'" to be "'+t[i].type+'", got "'+e+'"')):"optional"===t[i].type?new Error('Expecting "'+i+'" to be one of "'+t[i].types+'", got "'+typeof e+'"'):new Error('Expecting "'+i+'" to be a "'+t[i].type+'", got "'+typeof e+'"');return n[i]=e,e}}),o[i]=e[i]):Object.defineProperty(o,i,l):Object.defineProperty(o,i,l)}return o}}c.StringNotBlank=c(function(e){return"string"==typeof e&&e.trim().length>0});const s=new c({name:c.StringNotBlank,init:[Function],in:[Function],close:[Function],out:Function,error:Function});function u(e,t,r){t||(e=e.path||"");var n={filename:e,exports:{},Blueprint:null,resolve:{},require:function(e,t){return window.http.module.in.call(window.http.module,e,t)}};if(!r)return n;n.resolve[n.filename]=function(e){r(null,e),delete n.resolve[n.filename]};const o='module.resolve["'+e+'"](function(iifeModule){\n  var module = Module(iifeModule)\n  var __filename = module.filename\n  var __dirname = __filename.slice(0, __filename.lastIndexOf("/"))\n  var require = module.require\n  var exports = module.exports\n  var process = { browser: true }\n  var Blueprint = null;\n\n(function() {\n"use strict";\n'+t+"\n}).call(module.exports);\n  if (Blueprint) { return Blueprint}\n  return module.exports\n}(module));";return window.module=n,window.global=window,window.Module=u,o}window.require=function(e,t){return window.http.module.init.call(window.http.module),window.http.module.in.call(window.http.module,e,t)};const f={name:"loaders/http",protocol:"loader",loaded:!0,callbacks:[],module:{name:"http",init:function(){this.isBrowser="object"==typeof window},in:function(e,t,r){return this.isBrowser?this.browser.load.call(this,e,r):r("URL loading with node.js not supported yet (Coming soon!).")},normalizeFilePath:function(e){if(e.indexOf("http")>=0)return e;let t=e+(-1===e.indexOf(".js")?".js":"");return t="blueprints/"+t},browser:{load:function(t,r){const n=this.normalizeFilePath(t);e("[http loader] Loading file: "+n);var o=!0,i=null;r||(o=!1,r=function(e,t){if(e)throw new Error(e);return i=t});const l=new XMLHttpRequest,a=new this.browser.scriptEvents(this,t,r);return l.addEventListener("load",a.onLoad),l.addEventListener("error",a.onError),l.open("GET",n,o),l.send(null),i},scriptEvents:function(e,t,r){this.callback=r,this.fileName=t,this.onLoad=e.browser.onLoad.call(this,e),this.onError=e.browser.onError.call(this,e)},onLoad:function(e){const t=this;return function(){if(this.status>400)return t.onError.call(this,this.statusText);const r=u(this.responseURL,this.responseText,t.callback);var n=document.documentElement,o=document.createElement("script");o.textContent=r,n.appendChild(o),e.browser.cleanup(o,t)}},onError:function(t){const r=this,n=r.fileName;return function(){if(t.browser.cleanup(this,r),-1===n.indexOf(".js")&&-1===n.indexOf("index.js"))return e.warn("[http] Attempting to fallback to: ",n+"/index.js"),t.in.call(t,n+"/index.js",r.callback);r.callback("Could not load Blueprint")}},cleanup:function(e,t){e.removeEventListener("load",t.onLoad),e.removeEventListener("error",t.onError)}},node:{}}};window.http=f;const p={"loaders/http":f,"loaders/file":{name:"loaders/file",protocol:"embed",loaded:!0,callbacks:[],module:{name:"file",init:function(){this.isBrowser="object"==typeof window},in:function(t,r){if(this.isBrowser)throw new Error("File:// loading within browser not supported yet. Try relative URL instead.");e("[file loader] Loading file: "+t);const n=this.normalizeFilePath(t);require(n),r()},normalizeFilePath:function(e){return require("path").resolve(process.cwd()+"/../blueprints/"+e)}}}};function d(e){return{file:e,path:e,name:e.trim().toLowerCase(),protocol:function(e){if(!e||"string"!=typeof e)throw new Error("Invalid loader blueprint name");var t=e.match(/:\/\//gi)&&e.split(/:\/\//gi);return t?t[0]:"object"==typeof window?"http":"file"}(e)}}const m=function(t,r,n){try{const o=d(t),i=o.name,l=o.protocol;if(e("loading module:",i),p[i])return p[i].loaded?n(p[i].module):p[i].callbacks.push(n);p[i]={fileName:i,protocol:l,loaded:!1,callbacks:[n]},Frame("Loaders/"+l).from(i).to(i,r);const a="loaders/"+l;p[a].module.init(),p[a].module.in(i,r,function(t,r){if(t)e("Error: ",t,i);else{if(e("Loaded Blueprint module: ",i),!r||"object"!=typeof r)throw new Error("Invalid Blueprint file, Blueprint is expected to be an object or class");if("string"!=typeof r.name)throw new Error("Invalid Blueprint file, Blueprint missing a name");let t=p[i];if(!t)throw new Error("Uh oh, we shouldnt be here");if(t.loaded)throw new Error('Blueprint "'+r.name+'" already loaded.');t.module=r,t.loaded=!0,function(e){for(let t of e.callbacks)t(e.module);e.callbacks=[]}(t)}})}catch(e){throw new Error("Could not load blueprint '"+t+"'\n"+e)}},w={};function h(n,o){if(!(this instanceof h))return new h(n,o);if("string"!=typeof n)throw new Error("Blueprint name '"+n+"' is not valid.\n");if(w[n])return w[n];let a=new b(n);return m(n,o,function(o){try{if(e("Blueprint loaded:",o.name),"object"!=typeof o)throw new Error("Blueprint is expected to be an object or class");t(a,o),r(a,o.name,!1),a.Frame.name=o.name,(a=s(a)).Frame.loaded=!0,i(l,1,a),a.singleton&&(w[a.name]=a)}catch(e){throw new Error("Blueprint '"+n+"' is not valid.\n"+e)}}),a}function b(e){let o=new y(e);r(o,"Blueprint",!0),t(o,n);let i=Object.create(a);return t(i,a),Object.defineProperty(o,"Frame",{value:i,enumerable:!0,configurable:!0,writable:!1}),o.Frame.name=e,o}function y(e){return function(){let t=new h(e);return t.Frame.props=arguments,t}}var g,j;r(h,"Constructor"),r(h.constructor,"Frame"),g="Frame",j=h,"object"==typeof module&&"object"==typeof module.exports&&(module.exports=j),"object"==typeof global?global[g]=j:"function"==typeof define&&define.amd?define(["exports"],function(e){e[g]=j}):"object"==typeof window&&(window[g]=j)}();
