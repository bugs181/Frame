!function(){"use strict";function e(){console.log.apply(this,arguments)}function t(e,t){"object"==typeof module&&"object"==typeof module.exports&&(module.exports=t),"object"==typeof global?global[e]=t:"function"==typeof define&&define.amd?define(["exports"],function(r){r[e]=t}):"object"==typeof window&&(window[e]=t)}function r(e,t){for(const r of Object.getOwnPropertyNames(t))"name"!==r&&("object"==typeof t[r]?Array.isArray(t[r])?e[r]=[]:e[r]=Object.create(t[r],Object.getOwnPropertyDescriptors(t[r])):Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r)));return e}function n(e,t,r){Object.defineProperty(e,"toString",{enumerable:!1,writable:!1,configurable:!0,value:function(){return t?"[Frame: "+t+"]":"[Frame: Constructor]"}}),Object.defineProperty(e,"name",{enumerable:!1,writable:!1,configurable:!!r,value:t})}function o(e,t){const r=t?Array.from(t):[];if(!e)return r;const n={};let o=0;for(const t of e)n[t.name]=r[o],o++;return 0===o?t:n}function i(){if(this.Frame.processingFlow)return;if(this.Frame.pipes.length<1)return;if(!function(){if(!this.Frame.initialized)return c.call(this,i),!1;let e=!0;for(const t of this.Frame.pipes){const r=t.target;r.stub||(r.Frame.loaded?r.Frame.initialized||(c.call(r,i.bind(this)),e=!1):e=!1)}return e}.call(this))return;this.Frame.processingFlow=!0,this.Frame.pipes.unshift({direction:"to",target:this});let e=1;for(const t of this.Frame.pipes){const r=t.target;if("from"===t.direction){if("function"!=typeof r.on)throw new Error("Blueprint '"+r.name+"' does not support events.");r&&r.Frame&&r.Frame.parents.push({target:this}),t.context=s(this,t.target,0),this.Frame.events.push(t)}else if("to"===t.direction){if("function"!=typeof r.in)throw new Error("Blueprint '"+r.name+"' does not support input.");t.context=s(this,t.target,e),this.Frame.flow.push(t),e++}}(function(){for(const e of this.Frame.events){const t=e.target,r=o(t.Frame.describe.on,e.params);t.Frame.pipes&&t.Frame.pipes.length>0||t.Frame.processingFlow||t.on.call(e.context,r)}}).call(this)}function s(e,t,r){return{name:t.name,state:t.Frame.state,out:t.out.bind(e,r),error:t.error.bind(e,r)}}function c(t){const r=this;try{let n=r.Frame.props?r.Frame.props:{};r.init||(r.init=function(e,t){t()}),n=o(r.Frame.describe.init,n),r.init.call(r,n,function(n){if(n)return e.error("Error initializing blueprint '"+r.name+"'\n"+n);r.Frame.props={},r.Frame.initialized=!0,r.Frame.initializing=!1,setTimeout(function(){t&&t.call(r)},1)})}catch(e){throw new Error("Blueprint '"+r.name+"' could not initialize.\n"+e)}}e.error=function(){console.error.apply(this,arguments)},e.warn=function(){console.warn.apply(this,arguments)},e.debug=function(){console.log.apply(this,arguments)};const a={to:function(e){return d.call(this,"to",e,Array.from(arguments).slice(1))},from:function(e){return d.call(this,"from",e,Array.from(arguments).slice(1))},out:function(e,t){f(m,this,[e,null,t])},error:function(t,r){e.error("Worker "+this.name+".error:",r,arguments),f(m,this,[t,r])},get value(){if(!this.Frame)return"";const e=this;return new Promise(function(t,r){e.Frame.isPromised=!0,e.Frame.promise={resolve:t,reject:r}})}};function u(e){const t={};return r(t,a),t.stub=!0,t.Frame={parents:[],describe:[]},"function"==typeof e?(n(t,"Function"),t.in=e,t.on=e):(n(t,"Primitive"),t.in=function(){this.out(e)},t.on=function(){this.out(e)}),t}function l(e,t,r,n){const o=e.name;clearTimeout(r.Frame.debounce[o]),r.Frame.debounce[o]=setTimeout(function(){delete r.Frame.debounce[o],e.apply(r,n)},t)}function f(e,t,r){t.Frame.queue||(t.Frame.queue=[]);t.Frame.queue.length;t.Frame.queue.push(setTimeout(function(){e.apply(t,r)},1))}function p(e){return function(){return e.apply(this,arguments)}}function d(e,t,r){if(!this)throw new Error("Blueprint method called without instance, did you assign the method to a variable?");if(!this.Frame||!this.Frame.pipes)throw new Error("Not working with a valid Blueprint object");if(!t)throw new Error(this.Frame.name+"."+e+"() was called with improper parameters");"function"==typeof t&&"function"!=typeof t.to?t=u(t):"function"!=typeof t&&(t=u(t));let n=this;return n.Frame.instance||((n=n(Array.from(n.Frame.props)[0])).Frame.state=this.Frame.state,n.Frame.instance=!0),n.Frame.pipes.push({direction:e,target:t,params:r}),l(i,1,n),n}function m(e,t,r){const n=this.Frame.flow[e];if(t){if(!n||!n.target)return;if("Error"!==n.target.name)return e++,m.call(this,e,t);n.context.handleError=!0,r=t}if(n&&n.target)!function(e,t){const r=e.target,n=o(r.Frame.describe.in,e.params),i=e.context;let s,c;try{s=r.in.call(i,t,n,new p(h).bind(i)),c=typeof s}catch(e){s=e,c="error"}if("undefined"===c)return;"object"===c&&s instanceof Promise?s.then(i.out).catch(i.error):"error"===c||"object"===c&&s instanceof Error||"object"===c&&"Error"===s.constructor.name?i.error(s):i.out(s)}(n,r);else{this.Frame.processingFlow=!1,this.Frame.isPromised&&(this.Frame.promise.resolve(r),this.Frame.isPromised=!1);const e=this.Frame.parents;if(e.length>0)for(const t of e){f(m,t.target,[0,null,r])}}}function h(e,t){return e?this.error(e):this.out(t)}const b={name:"",describe:["init","in","out"],props:{},state:{},loaded:!1,initialized:!1,processingFlow:!1,instance:!1,debounce:{},queue:[],parents:[],pipes:[],events:[],flow:[],isPromised:!1,promise:{}};function w(e){if("function"==typeof e)return{type:e.name,expects:e};"object"!=typeof e&&(e={});const t=Object.create(e);Object.assign(t,e);for(const e of Object.keys(t))if("function"==typeof t[e])t[e]={required:!0,type:typeof t[e]()};else if("object"==typeof t[e]&&Array.isArray(t[e])){const r=t[e];t[e]={required:!1,type:"optional",types:[]};for(const n of r)"function"==typeof n&&t[e].types.push(typeof n())}else"object"==typeof t[e]&&t[e].type?t[e]={required:!0,type:t[e].type,expects:t[e].expects}:t[e]={required:!0,type:typeof t[e]};function r(e,r){return!t[e]||(!(!t[e].required||typeof r!==t[e].type)||(t[e].required||"optional"!==t[e].type?!(!t[e].required||!t[e].type||"function"!=typeof t[e].expects)&&t[e].expects(r):!(r&&!t[e].types.includes(typeof r))))}return function(e){const n={},o=e;for(const i of Object.getOwnPropertyNames(e)){const s=Object.getOwnPropertyDescriptor(e,i);if(s.writable&&s.configurable)if(t[i]){n[i]=e[i],Object.defineProperty(o,i,{enumerable:s.enumerable,configurable:s.configurable,get:function(){return n[i]},set:function(e){if(!r(i,e))throw t[i].expects?(e="string"==typeof e?e:typeof e,new Error('Expecting "'+i+'" to be "'+t[i].type+'", got "'+e+'"')):"optional"===t[i].type?new Error('Expecting "'+i+'" to be one of "'+t[i].types+'", got "'+typeof e+'"'):new Error('Expecting "'+i+'" to be a "'+t[i].type+'", got "'+typeof e+'"');return n[i]=e,e}});for(const i of Object.getOwnPropertyNames(t))o[i]||(n[i]=e[i],Object.defineProperty(o,i,{enumerable:s.enumerable,configurable:s.configurable,get:function(){return n[i]},set:function(e){if(!r(i,e))throw t[i].expects?(e="string"==typeof e?e:typeof e,new Error('Expecting "'+i+'" to be "'+t[i].type+'", got "'+e+'"')):"optional"===t[i].type?new Error('Expecting "'+i+'" to be one of "'+t[i].types+'", got "'+typeof e+'"'):new Error('Expecting "'+i+'" to be a "'+t[i].type+'", got "'+typeof e+'"');return n[i]=e,e}}));o[i]=e[i]}else Object.defineProperty(o,i,s);else Object.defineProperty(o,i,s)}return o}}w.StringNotBlank=w(function(e){return"string"==typeof e&&e.trim().length>0});const y=new w({name:w.StringNotBlank,init:[Function],in:[Function],on:[Function],describe:[Object],out:Function,error:Function,close:[Function],to:Function,from:Function,value:Function});function F(e,t,r){t||(e=e.path||"");var n={filename:e,exports:{},Blueprint:null,resolve:{},require:function(e,t){let r;return r=-1!==e.indexOf("./")?e:-1!==e.indexOf("http")?e:"../node_modules/"+e,window.http.module.in.call(window.http.module,r,null,t,!0)}};if(!r)return n;n.resolve[n.filename]=function(e){r(null,e),delete n.resolve[n.filename]};const o='module.resolve["'+e+'"](function(iifeModule){\n  var module = Module(iifeModule)\n  var __filename = module.filename\n  var __dirname = __filename.slice(0, __filename.lastIndexOf("/"))\n  var require = module.require\n  var exports = module.exports\n  var process = { browser: true }\n  var Blueprint = null;\n\n(function() {\n"use strict";\n'+t+"\n}).call(module.exports);\n  if (Blueprint) { return Blueprint}\n  return module.exports\n}(module));";return window.module=n,window.global=window,window.Module=F,window.require=n.require,o}const g={name:"loaders/http",protocol:"loader",loaded:!0,callbacks:[],module:{name:"HTTP Loader",protocol:["http","https","web://"],init:function(){this.isBrowser="object"==typeof window},in:function(e,t,r,n){return this.isBrowser?this.browser.load.call(this,e,r,n):r("URL loading with node.js not supported yet (Coming soon!).")},normalizeFilePath:function(e){if(e.indexOf("http")>=0)return e;return"blueprints/"+(e+(-1===e.indexOf(".js")?".js":""))},browser:{load:function(e,t,r){const n=r?e:this.normalizeFilePath(e);var o=!0,i=null;t||(o=!1,t=function(e,t){if(e)throw new Error(e);return i=t});const s=new XMLHttpRequest,c=new this.browser.scriptEvents(this,e,t);return s.addEventListener("load",c.onLoad),s.addEventListener("error",c.onError),s.open("GET",n,o),s.send(null),i},scriptEvents:function(e,t,r){this.callback=r,this.fileName=t,this.onLoad=e.browser.onLoad.call(this,e),this.onError=e.browser.onError.call(this,e)},onLoad:function(e){const t=this;return function(){if(this.status>400)return t.onError.call(this,this.statusText);const r=F(this.responseURL,this.responseText,t.callback);var n=document.documentElement,o=document.createElement("script");o.textContent=r,n.appendChild(o),e.browser.cleanup(o,t)}},onError:function(t){const r=this,n=r.fileName;return function(){if(t.browser.cleanup(this,r),-1===n.indexOf(".js")&&-1===n.indexOf("index.js"))return e.warn("[http] Attempting to fallback to: ",n+"/index.js"),t.in.call(t,n+"/index.js",r.callback);r.callback("Could not load Blueprint")}},cleanup:function(e,t){e.removeEventListener("load",t.onLoad),e.removeEventListener("error",t.onError)}},node:{}}};t("http",g);const j={"loaders/http":g,"loaders/file":{name:"loaders/file",protocol:"embed",loaded:!0,callbacks:[],module:{name:"File Loader",protocol:"file",init:function(){this.isBrowser="object"==typeof window},in:function(t,r,n){if(this.isBrowser)throw new Error("File:// loading within browser not supported yet. Try relative URL instead.");const o=require("vm"),i=require("fs"),s=this.normalizeFilePath(t),c=this.resolveFile(s);if(!c)return n("Blueprint not found");const a=i.readFileSync(c).toString(),u={Blueprint:null,require:function(e){return require(s+"/node_modules/"+e)},console:{log:e,error:e.error,warn:e.warn,info:e.info},global:global,module:module,__dirname:s};o.createContext(u),o.runInContext(a,u),n(null,u.Blueprint)},normalizeFilePath:function(e){return require("path").resolve(process.cwd(),"blueprints/",e)},resolveFile:function(e){const t=require("fs"),r=require("path");if(t.existsSync(e))return t.statSync(e).isDirectory()?r.resolve(e,"index.js"):e+(-1===e.indexOf(".js")?".js":"");const n=e+(-1===e.indexOf(".js")?".js":"");return!!t.existsSync(n)&&n}}}};function E(e){return{file:e,path:e,name:e.trim().toLowerCase(),protocol:function(e){if(!e||"string"!=typeof e)throw new Error("Invalid loader blueprint name");var t=e.match(/:\/\//gi)&&e.split(/:\/\//gi);return t?t[0]:"object"==typeof window?"http":"file"}(e)}}const v=function(t,r,n){try{const o=E(t),i=o.name,s=o.protocol;if(j[i])return j[i].loaded?n(j[i].module):j[i].callbacks.push(n);j[i]={fileName:i,protocol:s,loaded:!1,callbacks:[n]};const c="loaders/"+s;j[c].module.init(),j[c].module.in(i,r,function(t,r){if(t)e.error("Error: ",t,i);else{if(!r||"object"!=typeof r)throw new Error("Invalid Blueprint file, Blueprint is expected to be an object or class");if("string"!=typeof r.name)throw new Error("Invalid Blueprint file, Blueprint missing a name");const e=j[i];if(!e)throw new Error("Uh oh, we shouldnt be here");if(e.loaded)throw new Error('Blueprint "'+r.name+'" already loaded.');e.module=r,e.loaded=!0,function(e){for(const t of e.callbacks)t(e.module);e.callbacks=[]}(e)}})}catch(e){throw new Error("Could not load blueprint '"+t+"'\n"+e)}},x={};function O(e,t){if(!(this instanceof O))return new O(e,t);if("string"!=typeof e)throw new Error("Blueprint name '"+e+"' is not valid.\n");if(x[e])return x[e];let o=new B(e);return v(e,t,function(t){try{if("object"!=typeof t)throw new Error("Blueprint is expected to be an object or class");r(o,t),n(o,t.name,!1),o.Frame.name=t.name,(o=y(o)).Frame.describe=function(e,t){const r={};e||(e={});for(const e of t)r[e]=[];for(const t of Object.keys(e)){if(r[t]=[],"object"!=typeof e[t]||Array.isArray(e[t]))continue;const n=[];for(const r of Object.keys(e[t]))n.push({name:r,description:e[t][r]});r[t]=n}return r}(o.describe,b.describe),o.Frame.loaded=!0,l(i,1,o),o.singleton&&(x[o.name]=o)}catch(t){throw new Error("Blueprint '"+e+"' is not valid.\n"+t)}}),o}function B(e){const t=new P(e);n(t,"Blueprint",!0),r(t,a);const o=Object.create(b);return r(o,b),Object.defineProperty(t,"Frame",{value:o,enumerable:!0,configurable:!0,writable:!1}),t.Frame.name=e,t}function P(e){return function(){if(x[e])return x[e];const t=new O(e);return t.Frame.props=arguments,t}}n(O,"Constructor"),n(O.constructor,"Frame"),t("Frame",O)}();
